var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t.prototype.setCustomProgress=function(e,t,i){this.textField.text="["+i+"]  加载中..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var BgMap=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var t=RES.getRes("background_png");this.textureHeight=t.textureHeight,this.rowCount=Math.ceil(this.stageH/this.textureHeight)+1,this.bmpArr=[];for(var i=0;i<this.rowCount;i++){var s=new egret.Bitmap,t=RES.getRes("background_png");s.texture=t;var n=s;n.y=this.textureHeight*i-(this.textureHeight*this.rowCount-this.stageH),this.bmpArr.push(n),this.addChild(n)}},t.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},t.prototype.enterFrameHandler=function(e){for(var t=0;t<this.rowCount;t++){var i=this.bmpArr[t];i.y+=GameSetting.speed,i.y>this.stageH&&(i.y=this.bmpArr[0].y-this.textureHeight,this.bmpArr.pop(),this.bmpArr.unshift(i))}},t.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},t}(egret.DisplayObjectContainer);__reflect(BgMap.prototype,"BgMap");var Initiator=function(){function e(){}return Object.defineProperty(e,"getInstance",{get:function(){return e.instance||(e.instance=new e),e.instance},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t){this._stage=e,this._main=t,KeyBoardManager.getInstance.addKeyboardListener()},e.prototype.getStage=function(){return this._stage},e.prototype.main=function(){return this._main},e}();__reflect(Initiator.prototype,"Initiator");var Keyboard;!function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.CAPSLOCK=20]="CAPSLOCK",e[e.ESC=27]="ESC",e[e.SPACE=32]="SPACE",e[e.PAGEUP=33]="PAGEUP",e[e.PAGEDOWN=34]="PAGEDOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.NUM_0=48]="NUM_0",e[e.NUM_1=49]="NUM_1",e[e.NUM_2=50]="NUM_2",e[e.NUM_3=51]="NUM_3",e[e.NUM_4=52]="NUM_4",e[e.NUM_5=53]="NUM_5",e[e.NUM_6=54]="NUM_6",e[e.NUM_7=55]="NUM_7",e[e.NUM_8=56]="NUM_8",e[e.NUM_9=57]="NUM_9",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.NUMPAD_0=96]="NUMPAD_0",e[e.NUMPAD_1=97]="NUMPAD_1",e[e.NUMPAD_2=98]="NUMPAD_2",e[e.NUMPAD_3=99]="NUMPAD_3",e[e.NUMPAD_4=100]="NUMPAD_4",e[e.NUMPAD_5=101]="NUMPAD_5",e[e.NUMPAD_6=102]="NUMPAD_6",e[e.NUMPAD_7=103]="NUMPAD_7",e[e.NUMPAD_8=104]="NUMPAD_8",e[e.NUMPAD_9=105]="NUMPAD_9",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12"}(Keyboard||(Keyboard={}));var KeyBoardManager=function(){function e(){}return Object.defineProperty(e,"getInstance",{get:function(){return e.instance||(e.instance=new e),e.instance},enumerable:!0,configurable:!0}),e.prototype.addKeyboardListener=function(){document.onkeydown=function(e){if(e)switch(console.log(e),e.keyCode){case 37:break;case 38:break;case 39:break;case 40:}},document.onkeyup=function(e){e&&console.log(e)}},e}();__reflect(KeyBoardManager.prototype,"KeyBoardManager");var UIUtils=function(){function e(){}return e.showBorder=function(e){e.graphics.beginFill(16711680,0),e.graphics.lineStyle(1,255,1,!0),e.graphics.drawRect(0,0,e.width,e.height)},e.showBorderByRect=function(e,t){e.graphics.beginFill(16711680,0),e.graphics.lineStyle(1,255,1,!0),e.graphics.drawRect(t.x,t.y,t.width,t.height)},e}();__reflect(UIUtils.prototype,"UIUtils");var GameSetting=function(){function e(){}return e}();GameSetting.speed=4,GameSetting.shootTime=200,GameSetting.enemyFightersTime=2e3,GameSetting.enemyShootTime=800,GameSetting.keyMove=40,GameSetting.myBulletSpeed=7,GameSetting.enemyBulletSpeed=6,GameSetting.enemyPlaneSpeed=4,__reflect(GameSetting.prototype,"GameSetting");var FilterUtils=function(){function e(){}return e.createGlowFilter=function(e,t,i,s,n,r,o,h){var a=new egret.GlowFilter(e,t,i,s,n,r,o,h);return a},e}();__reflect(FilterUtils.prototype,"FilterUtils");var Main=function(e){function t(){var t=e.call(this)||this;return t.listResources=new Array(new Resources("Plane","飞机模型"),new Resources("Bullet","子弹模型"),new Resources("Bgm","背景音乐")),t.enemyFighterslist=[],t.Bulletlist=[],Initiator.getInstance.init(t.stage,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t._lastTime=egret.getTimer(),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),this.score=new ScoreBoard,this.stage.addChild(this.score),this.score.setScore(0),this.score.x=this.score.y=10,this.drawSP=new egret.Sprite,RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);for(var t in this.listResources){var i=this.listResources[t],s=i;RES.loadGroup(s.name)}},t.prototype.onResourceLoadComplete=function(e){var t=!1;for(var i in this.listResources){var s=this.listResources[i],n=s;e.groupName==n.name&&(n.isOver=!0),t=n.isOver}t&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.bg=new BgMap,this.addChild(this.bg),this.createGameScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){for(var t in this.listResources){var i=this.listResources[t],s=i;e.groupName==s.name&&this.loadingView.setCustomProgress(e.itemsLoaded,e.itemsTotal,s.chinese)}},t.prototype.createGameScene=function(){this.start()},t.prototype.GameOver=function(){var e=RES.getRes("game_over_mp3");e.play(0,1),this._channel.stop(),this._channel=null,this.planeShootTime.stop(),this.enemyFightersTimer.stop(),this.enemyShootTime.stop(),this.planeShootTime=null,this.enemyFightersTimer=null,this.enemyShootTime=null;for(var t in this.enemyFighterslist)this.removeChild(this.enemyFighterslist[t]);this.enemyFighterslist=[];for(var t in this.Bulletlist)this.removeChild(this.Bulletlist[t].Image);this.Bulletlist=[],this.bg.pause();var i=this.myfighter.scores;this.removeChild(this.myfighter),this.myfighter=null;var s=new egret.Bitmap(RES.getRes("gameover_png")),n=new egret.Bitmap(RES.getRes("btn_finish_png")),r=new egret.TextField;r.text=i+"分",r.x=this.stage.stageWidth/2-r.width/2,r.y=this.stage.stageHeight/2,n.x=this.stage.stageWidth/2-n.width/2,n.y=this.stage.stageHeight/2+80;var o=this;n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){o._lastTime=0,o.removeChild(s),o.removeChild(r),o.removeChild(n),o.start.apply(o)},this),this.addChild(s),this.addChild(r),this.addChild(n)},t.prototype.start=function(){this.bg.start(),this.sound=RES.getRes("game_music_mp3"),this._channel=this.sound.play(0,-1),this.planeShootTime=new egret.Timer(GameSetting.shootTime),this.enemyFightersTimer=new egret.Timer(GameSetting.enemyFightersTime),this.enemyShootTime=new egret.Timer(GameSetting.enemyShootTime),this.myfighter=new Blueplane(this),this.addChild(this.myfighter),this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.planeShootTime.addEventListener(egret.TimerEvent.TIMER,this.AddMyPlane,[this,this.myfighter]),this.planeShootTime.start(),this.enemyShootTime.addEventListener(egret.TimerEvent.TIMER,this.enemyShootTimefun,this),this.enemyShootTime.start(),this.enemyFightersTimer.addEventListener(egret.TimerEvent.TIMER,this.enemyFightersTimerfun,this),this.enemyFightersTimer.start()},t.prototype.AddMyPlane=function(){var e=this[1].Shoot();this[0].Bulletlist.push(e),this[0].addChild(e.Image),e.bulletSound.play(0,1)},t.prototype.enemyShootTimefun=function(){var e,t=0,i=this.enemyFighterslist.length;for(t=0;i>t;t++)e=this.enemyFighterslist[t],this.sendEnemyBullet(e)},t.prototype.enemyFightersTimerfun=function(){var e=Math.random()*(this.stage.width-128),t=new Enemyplane(e,-128);this.enemyFighterslist.push(t),this.addChild(t),this.sendEnemyBullet(t)},t.prototype.sendEnemyBullet=function(e){var t=e.Shoot();this.Bulletlist.push(t),this.addChild(t.Image)},t.prototype.gameViewUpdate=function(e){var t=egret.getTimer(),i=1e3/(t-this._lastTime);this._lastTime=t;for(var s,n=60/i,r=0,o=this.Bulletlist.length;o>r;r++)s=this.Bulletlist[r],"UP"==s.Type?(s.Y<0&&(this.removeChild(s.Image),this.Bulletlist.splice(r,1),r--,o--),s.Y=s.Image.y-=GameSetting.myBulletSpeed*n):"Down"==s.Type&&(s.Y-s.Image.height>this.stage.stageHeight&&(this.removeChild(s.Image),this.Bulletlist.splice(r,1),r--,o--),s.Y=s.Image.y+=GameSetting.enemyBulletSpeed*n);var h,a=this.enemyFighterslist.length;for(r=0;a>r;r++)h=this.enemyFighterslist[r],h.y-h.height>this.stage.stageHeight&&(this.removeChild(h),this.enemyFighterslist.splice(r,1),r--,a--),h.y+=GameSetting.enemyPlaneSpeed*n;this.collision()},t.prototype.collision=function(){var e=this.Bulletlist,t=this.enemyFighterslist,i=this.myfighter;for(var s in t)if(null!=this.myfighter){var n=this.hitTestP(i,t[s]);if(n)return this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),void this.GameOver.apply(this)}for(var r in e)if(1==e[r].from){if(null!=i){var o;if(o=this.hitTestP(i,e[r].Image))return this.removeChild(e[r].Image),e.splice(e.indexOf(e[r]),1),this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),void this.GameOver.apply(this)}}else for(var h in t){var o;o=this.hitTestP(t[h],e[r].Image),o&&(this.removeChild(e[r].Image),e.splice(e.indexOf(e[r]),1),this.removeChild(t[h]),t.splice(t.indexOf(t[h]),1),this.myfighter.scores+=1,this.score.setScore(this.myfighter.scores))}},t.prototype.hitTestP=function(e,t){var i=e.getBounds(),s=t.getBounds();return 180==e.rotation?(i.x=e.x-e.width,i.y=e.y-e.height):(i.x=e.x,i.y=e.y),180==t.rotation?(s.x=t.x-t.width,s.y=t.y-t.height):(s.x=t.x,s.y=t.y),this.addChild(this.drawSP),this.drawSP.graphics.clear(),i.intersects(s)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Bullet=function(){function e(){}return e}();__reflect(Bullet.prototype,"Bullet");var Plane=function(){function e(){}return e}();__reflect(Plane.prototype,"Plane");var Resources=function(){function e(e,t){this.name=e,this.chinese=t,this.isOver=!1}return e}();__reflect(Resources.prototype,"Resources");var Blueplane=function(e){function t(t){var i=e.call(this)||this;return i.init(t),i}return __extends(t,e),t.prototype.init=function(e){this.scores=0;var t=new egret.Bitmap(RES.getRes("BluePlane_png"));this.addChild(t),this.plane=new Plane,this.plane.blood=100,this.plane.bulletImage="bullet_03_png";var i=RES.getRes("bullet_mp3");this.plane.bulletSound=i,this.BottomCenter(e),t.touchEnabled=!0,e.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.PlaneMoveHandle,[this,e]),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.PlaneMoveHandle,[this,e]),this.addKeyboardListener(this,e)},t.prototype.PlaneMoveHandle=function(e){var t=this[0],i=this[1],s=t.height,n=t.width;t.x=e.stageX-n/2,t.y=e.stageY-s/2,t.x<=0&&(t.x=0),e.stageX+n/2>=i.stage.stageWidth&&(t.x=i.stage.stageWidth-n),t.y<=0&&(t.y=0),e.stageY+s/2>=i.stage.stageHeight&&(t.y=i.stage.stageHeight-s)},t.prototype.addKeyboardListener=function(e,t){document.onkeydown=function(i){i&&(console.log(i),e.keyBoardMove(i.keyCode,t))},document.onkeyup=function(e){e&&console.log(e)}},t.prototype.keyBoardMove=function(e,t){this[0];if(null!=this){var i,s,n=t,r=this.height,o=this.width;switch(e){case 37:i=this.x-GameSetting.keyMove;break;case 38:s=this.y-GameSetting.keyMove;break;case 39:i=this.x+GameSetting.keyMove;break;case 40:s=this.y+GameSetting.keyMove}i&&(0>=i?this.x=0:i+o>=n.stage.stageWidth?this.x=n.stage.stageWidth-o:this.x=i),s&&(0>=s?this.y=0:s+r>=n.stage.stageHeight?this.y=n.stage.stageHeight-r:this.y=s)}},t.prototype.BottomCenter=function(e){var t=e.stage.stageWidth,i=e.stage.stageHeight;this.height,this.width;this.x=t/2-this.width/2,this.y=i-this.height},t.prototype.Shoot=function(){var e=new Bullet;return e.Type="UP",e.Image=new egret.Bitmap(RES.getRes(this.plane.bulletImage)),e.Image.width=64,e.Image.height=64,e.from=!1,e.bulletSound=this.plane.bulletSound,e.X=this.x+(this.width/2-35),e.Y=this.y-45,e.Image.x=e.X,e.Image.y=e.Y,e},t}(egret.Sprite);__reflect(Blueplane.prototype,"Blueplane");var Enemyplane=function(e){function t(t,i){var s=e.call(this)||this;return s.init(t,i),s}return __extends(t,e),t.prototype.init=function(e,t){var i=["GodPlane_png","GreenPlane_png","JitPlane_png","JpPlane_png","LiPlane_png","LXPlane_png"],s=Math.floor(Math.random()*i.length);this.plane=new Plane;var n=new egret.Bitmap(RES.getRes(i[s]));this.plane.blood=100,this.plane.bulletImage="bullet_02_png",this.addChild(n),this.rotation=180,this.x=e+128,this.y=t+128},t.prototype.Shoot=function(){var e=new Bullet;return e.Type="Down",e.Image=new egret.Bitmap(RES.getRes(this.plane.bulletImage)),e.Image.width=64,e.Image.height=64,e.from=!0,e.Image.rotation=180,e.X=this.x+31-this.width/2,e.Y=this.y+60,e.Image.x=e.X,e.Image.y=e.Y,e},t}(egret.Sprite);__reflect(Enemyplane.prototype,"Enemyplane");var ScoreBoard=function(e){function t(){var t=e.call(this)||this;return t.scoreTxt=new egret.TextField,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.scoreTxt=new egret.TextField,this.addChild(this.scoreTxt),this.width=100,this.scoreTxt.textAlign="center",this.scoreTxt.size=26,this.scoreTxt.textColor=32896},t.prototype.setScore=function(e){this.scoreTxt.text="分数："+e},t}(egret.Sprite);__reflect(ScoreBoard.prototype,"ScoreBoard");